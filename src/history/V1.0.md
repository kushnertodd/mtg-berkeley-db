# Version 1.0 Features

## User Interface
  * 
  * processes command line arguments
  * reads request db config jsonfile
  * usage

| option | description                 |default|
|--------|-----------------------------|-------|
| -b     | cache bytes                 |0
| -d     | request db config json file |(none)
| -f     | json request file           |(none)
| -g     | cache gigabytes             |4
| -h     | database home directory     |(none)

## Database Configuration
Reads database configuration from JSON file `bdb-databases.json`.
The JSON has the following format.
- Databases  
Databases include a list of *primary* and *secondary* databases.
These are loaded and the code opens databases using these descriptors.
The database names are all relative to the `db_home` command line option.
```json
{
 "class_name": "Bdb_databases_config",
 "primary_databases": [
     <primary-database>,
     ...
   ]
}
```
- Primary databases  
Primary databases are given a name and a list of secondary databases.
When opened, secondary databases are automatically `associated()` with the primary database.
```json
{
  "class_name": "Primary_database_config",
  "name": "principals-1",
  "database-file": <database-file>,
  "secondary_databases": [
    <secondary-database>,
    ...
  ]
}
```
- Secondary databases  
Secondary databases contain keys associated with the primary databases.
The keys are generally duplicate and read with a cursor.
```json
 *         {
 *           "class_name": "Secondary_database_config",
 *           "name": "name_id",
 *           "database-file": <database-file>,
 *           "key_extractor": "get_principals_name_id"
 *         }
```
## Requests
Requests are stored in a JSON file. 
Each takes a single list of string arguments.
```json
{
  "class_name": "Imdb_request",
  "request": "<request-name>",
  "arguments": [
    "request=argument",
    ...
  ]
}
```
### Request types
There four types of requests supported.

|Request|Description
|-|-
|Load|Load tab-delimited file records into database
|Lookup|Look up record for primary key
|Search|Lookup records corresponding to secondary key
|Select|Find all primary key records in a database

The data comes from the [IMDB Datasets](https://developer.imdb.com/non-commercial-datasets/).
Each data type has a unique primary key id.
*d* indicates a digit 0-9.

| Request | Key                                    |Description
|---------|----------------------------------------|-
| Name    | IMDB name id (`nconst`=`nn`*ddddddd*)  |Actor or actress name
| Title   | IMDB title id (`tconst`=`tt`*ddddddd*) |Show (movie or TV) title                        
|Principals| unique number 1-*n*                    |Associates actor/actress with a particular show (`nconst`with`tconst`) 
| Rating  | title `tconst`                         | IMDB show rating                                                       
These are a list of the specific requests.
* Load requests    
These requests load up separate databases for each data type.
  * Load name  
  * Load principals  
  * Load ratings  
  * Load title
* Lookup requests  
These requests look up a name by `nconst` or a rating or title by `tconst`.
  * Lookup name  
  * Lookup ratings  
  * Lookup title
* Search requests    
These requests select all titles associated with an actor/actress (by `nconst)
or actor/actress associated with a show (by `tconst`).
  * Search name  
  * Search title
* Select requests    
These request all primary key records in the corresponding tables.
    * Select name  
    * Select principals  
    * Select ratings  
    * Select title  
## Test cases
A set of scripts to run each request are in the `src/scripts` directory.
The scripts `check.sh` runs all scripts as unit tests and checks the results.
## Berkeley DB libary
A library `bdb-lib` allows convenient access to the published [Berkeley DB](https://www.oracle.com/database/technologies/related/berkeleydb.html) 
C++ [library](https://docs.oracle.com/database/bdb181/html/gsg/CXX/index.html).
It provides convenience classes that wrap the Berkeley DB
`Dbt` and `Dbc` and allow creating more concise and intuitive.
A separate project [berkeley-db-cpp-framework](https://github.com/kushnertodd/berkeley-db-cpp-framework/blob/main/README.md)
contains the library and the C++ example from the [Berkeley DB distribution](http://www.oracle.com/technetwork/database/database-technologies/berkeleydb/downloads/index.html)
converted to use the libary.